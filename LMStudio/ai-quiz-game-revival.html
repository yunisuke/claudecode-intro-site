<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç”Ÿæˆã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .genre-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .genre-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .genre-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .genre-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .quiz-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .question {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answers {
            display: grid;
            gap: 15px;
        }

        .answer-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px 20px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .answer-btn:hover:not(.disabled) {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .answer-btn.selected {
            border-color: #667eea;
            background: #e0e7ff;
        }

        .answer-btn.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .answer-btn.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .answer-btn.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .explanation {
            margin-top: 20px;
            padding: 15px;
            background: #e0f2fe;
            border-radius: 10px;
            border-left: 4px solid #0284c7;
            min-height: 80px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .explanation.show {
            opacity: 1;
            visibility: visible;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .score-display {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            color: #555;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .genre-selector {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }
        }

        .result-section {
            display: none;
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .result-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: #333;
        }

        .result-score {
            font-size: 48px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .result-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .quiz-counter {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            display: none;
            border: 2px solid #fca5a5;
        }
        
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div style="text-align: left; margin-bottom: 20px;">
            <a href="gpt-oss.html" style="color: #667eea; text-decoration: none; font-size: 14px; transition: all 0.3s;">
                â† GPT-OSSç´¹ä»‹ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
            </a>
        </div>
        <h1>ğŸ® AIã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ  ğŸ¤–</h1>
        
        <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div class="error-message" id="errorMessage">
            âš ï¸ ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“
        </div>
        
        <!-- ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ -->
        <div id="genreSection">
            <h2 style="text-align: center; margin-bottom: 20px; color: #555;">ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„</h2>
            <div class="genre-selector">
                <div class="genre-card" data-genre="science">
                    <span style="font-size: 24px;">ğŸ”¬</span>
                    <span>ç§‘å­¦</span>
                </div>
                <div class="genre-card" data-genre="history">
                    <span style="font-size: 24px;">ğŸ“š</span>
                    <span>æ­´å²</span>
                </div>
                <div class="genre-card" data-genre="geography">
                    <span style="font-size: 24px;">ğŸŒ</span>
                    <span>åœ°ç†</span>
                </div>
                <div class="genre-card" data-genre="sports">
                    <span style="font-size: 24px;">âš½</span>
                    <span>ã‚¹ãƒãƒ¼ãƒ„</span>
                </div>
                <div class="genre-card" data-genre="entertainment">
                    <span style="font-size: 24px;">ğŸ¬</span>
                    <span>ã‚¨ãƒ³ã‚¿ãƒ¡</span>
                </div>
                <div class="genre-card" data-genre="technology">
                    <span style="font-size: 24px;">ğŸ’»</span>
                    <span>ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼</span>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="startGame()" id="startBtn" disabled>ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            </div>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="quiz-section" id="quizSection">
            <div class="quiz-counter" id="quizCounter">å•é¡Œ 1 / 5</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>
            <div class="question-box">
                <div class="question" id="questionText">
                    å•é¡Œã‚’ç”Ÿæˆä¸­...<span class="loading"></span>
                </div>
                <div class="answers" id="answersContainer"></div>
                <div class="explanation" id="explanation"></div>
            </div>
            <div class="score-display">
                ã‚¹ã‚³ã‚¢: <span id="currentScore">0</span> / <span id="totalQuestions">5</span>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">æ¬¡ã®å•é¡Œ</button>
                <button class="btn btn-secondary" onclick="resetGame()">æœ€åˆã«æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤º -->
        <div class="result-section" id="resultSection">
            <h2 class="result-title">ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ ğŸ‰</h2>
            <div class="result-score" id="finalScore">5 / 5</div>
            <div class="result-message" id="resultMessage">ç´ æ™´ã‚‰ã—ã„æˆç¸¾ã§ã™ï¼</div>
            <div class="controls">
                <button class="btn btn-primary" onclick="resetGame()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ è¨­å®š
        const gameConfig = {
            apiEndpoint: 'https://mocha.ai-sample.net/v1/chat/completions',
            apiKey: '', // ã“ã“ã«APIã‚­ãƒ¼ã‚’è¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ï¼‰
            totalQuestions: 5,
            demoMode: false
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            selectedGenre: null,
            currentQuestion: 0,
            score: 0,
            quizzes: [],
            userAnswers: [],
            isAnswered: false
        };

        // ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹ã‚’ä¿æŒ
        let serverAvailable = false;

        // ã‚¸ãƒ£ãƒ³ãƒ«ã‚«ãƒ¼ãƒ‰ã®é¸æŠ
        function setupGenreCards() {
            document.querySelectorAll('.genre-card').forEach(card => {
                card.addEventListener('click', function() {
                    // ã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
                    if (!serverAvailable) return;
                    
                    document.querySelectorAll('.genre-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    gameState.selectedGenre = this.dataset.genre;
                    document.getElementById('startBtn').disabled = false;
                });
            });
        }
        
        // åˆæœŸè¨­å®š
        setupGenreCards();

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        async function startGame() {
            // ã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (!serverAvailable) {
                return;
            }
            
            if (!gameState.selectedGenre) {
                alert('ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            // UIã®åˆæœŸåŒ–ï¼ˆå‰å›ã®çµæœã‚’ã‚¯ãƒªã‚¢ï¼‰
            document.getElementById('questionText').innerHTML = `${gameConfig.totalQuestions}å•åˆ†ã®ã‚¯ã‚¤ã‚ºã‚’ç”Ÿæˆä¸­...<span class="loading"></span>`;
            document.getElementById('answersContainer').innerHTML = '';
            document.getElementById('explanation').innerHTML = '';
            document.getElementById('explanation').classList.remove('show');
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('progressFill').style.width = '20%';
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('totalQuestions').textContent = gameConfig.totalQuestions;
            
            // UIã®åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('genreSection').style.display = 'none';
            document.getElementById('quizSection').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.quizzes = [];
            gameState.userAnswers = [];
            gameState.isAnswered = false;
            
            // å•é¡Œã‚’ç”Ÿæˆ
            await generateAllQuizzes();
            
            // æœ€åˆã®å•é¡Œã‚’è¡¨ç¤º
            if (gameState.quizzes.length > 0) {
                displayQuestion();
            }
        }

        // å…¨å•é¡Œã‚’ä¸€æ‹¬ç”Ÿæˆ
        async function generateAllQuizzes() {
            const questionText = document.getElementById('questionText');
            questionText.innerHTML = `${gameConfig.totalQuestions}å•åˆ†ã®ã‚¯ã‚¤ã‚ºã‚’ç”Ÿæˆä¸­...<span class="loading"></span>`;
            
            const genreNames = {
                'science': 'ç§‘å­¦',
                'history': 'æ­´å²',
                'geography': 'åœ°ç†',
                'sports': 'ã‚¹ãƒãƒ¼ãƒ„',
                'entertainment': 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆ',
                'technology': 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼'
            };
            
            const selectedGenreName = genreNames[gameState.selectedGenre];
            
            try {
                const headers = {
                    'Content-Type': 'application/json',
                };
                
                // APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è¿½åŠ 
                if (gameConfig.apiKey) {
                    headers['X-API-Key'] = gameConfig.apiKey;
                }
                
                const response = await fetch(gameConfig.apiEndpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'ã‚ãªãŸã¯æ—¥æœ¬èªã®ã‚¯ã‚¤ã‚ºã‚’ç”Ÿæˆã™ã‚‹AIã§ã™ã€‚æŒ‡å®šã•ã‚ŒãŸã‚¸ãƒ£ãƒ³ãƒ«ã«é–¢ã™ã‚‹èˆˆå‘³æ·±ã„æ—¥æœ¬èªã®ã‚¯ã‚¤ã‚ºã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚å¿…ãšæŒ‡å®šã•ã‚ŒãŸJSONå½¢å¼ã§ã€ã™ã¹ã¦æ—¥æœ¬èªã§è¿”ç­”ã—ã¦ãã ã•ã„ã€‚'
                            },
                            {
                                role: 'user',
                                content: `${selectedGenreName}ã«é–¢ã™ã‚‹æ—¥æœ¬èªã®ã‚¯ã‚¤ã‚ºã‚’${gameConfig.totalQuestions}å•ä½œæˆã—ã¦ãã ã•ã„ã€‚
                                
ä»¥ä¸‹ã®JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚ä»–ã®æ–‡ç« ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ï¼š
[
  {
    "question": "æ—¥æœ¬èªã®å•é¡Œæ–‡",
    "choices": ["æ—¥æœ¬èªã®é¸æŠè‚¢1", "æ—¥æœ¬èªã®é¸æŠè‚¢2", "æ—¥æœ¬èªã®é¸æŠè‚¢3", "æ—¥æœ¬èªã®é¸æŠè‚¢4"],
    "correct": 0,
    "explanation": "æ—¥æœ¬èªã®è§£èª¬æ–‡"
  }
]

æ³¨æ„ï¼š
- ã™ã¹ã¦æ—¥æœ¬èªã§ä½œæˆã™ã‚‹ã“ã¨
- correctã¯æ­£è§£ã®é¸æŠè‚¢ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0-3ï¼‰
- å•é¡Œã¯å¾ã€…ã«é›£ã—ããªã‚‹ã‚ˆã†ã«ã™ã‚‹
- å„å•é¡Œã¯ç•°ãªã‚‹å†…å®¹ã«ã™ã‚‹
- ä¸€èˆ¬çš„ãªçŸ¥è­˜ã§ç­”ãˆã‚‰ã‚Œã‚‹å•é¡Œã«ã™ã‚‹`
                            }
                        ],
                        temperature: 0.8,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // JSONã‚’ãƒ‘ãƒ¼ã‚¹
                const quizzes = JSON.parse(content);
                
                if (Array.isArray(quizzes) && quizzes.length > 0) {
                    gameState.quizzes = quizzes.slice(0, gameConfig.totalQuestions);
                } else {
                    throw new Error('Invalid quiz format');
                }
                
            } catch (error) {
                console.error('Error generating quizzes:', error);
                // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                gameState.quizzes = generateDemoQuizzes();
            }
        }

        // ãƒ‡ãƒ¢ã‚¯ã‚¤ã‚ºç”Ÿæˆ
        function generateDemoQuizzes() {
            const demoQuizzes = {
                science: [
                    {
                        question: "æ°´ã®åŒ–å­¦å¼ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                        choices: ["H2O", "CO2", "O2", "N2"],
                        correct: 0,
                        explanation: "æ°´ã®åŒ–å­¦å¼ã¯H2Oï¼ˆã‚¨ã‚¤ãƒãƒ„ãƒ¼ã‚ªãƒ¼ï¼‰ã§ã™ã€‚æ°´ç´ åŸå­2ã¤ã¨é…¸ç´ åŸå­1ã¤ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚"
                    },
                    {
                        question: "å¤ªé™½ç³»ã§æœ€ã‚‚å¤§ãã„æƒ‘æ˜Ÿã¯ï¼Ÿ",
                        choices: ["åœ°çƒ", "ç«æ˜Ÿ", "æœ¨æ˜Ÿ", "åœŸæ˜Ÿ"],
                        correct: 2,
                        explanation: "æœ¨æ˜Ÿã¯å¤ªé™½ç³»æœ€å¤§ã®æƒ‘æ˜Ÿã§ã€åœ°çƒã®ç´„11å€ã®ç›´å¾„ãŒã‚ã‚Šã¾ã™ã€‚"
                    },
                    {
                        question: "å…‰ã®é€Ÿåº¦ã¯ç§’é€Ÿç´„ä½•ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«ï¼Ÿ",
                        choices: ["30ä¸‡km", "100ä¸‡km", "10ä¸‡km", "3ä¸‡km"],
                        correct: 0,
                        explanation: "å…‰ã®é€Ÿåº¦ã¯çœŸç©ºä¸­ã§ç§’é€Ÿç´„30ä¸‡ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«ï¼ˆæ­£ç¢ºã«ã¯299,792,458m/sï¼‰ã§ã™ã€‚"
                    },
                    {
                        question: "DNAã®æ­£å¼åç§°ã¯ï¼Ÿ",
                        choices: ["ãƒ‡ã‚ªã‚­ã‚·ãƒªãƒœæ ¸é…¸", "ãƒªãƒœæ ¸é…¸", "ã‚¢ãƒŸãƒé…¸", "ã‚¿ãƒ³ãƒ‘ã‚¯è³ª"],
                        correct: 0,
                        explanation: "DNAã®æ­£å¼åç§°ã¯ãƒ‡ã‚ªã‚­ã‚·ãƒªãƒœæ ¸é…¸ï¼ˆDeoxyribonucleic Acidï¼‰ã§ã™ã€‚"
                    },
                    {
                        question: "çµ¶å¯¾é›¶åº¦ã¯æ‘‚æ°ä½•åº¦ï¼Ÿ",
                        choices: ["-273.15â„ƒ", "-100â„ƒ", "-459.67â„ƒ", "0â„ƒ"],
                        correct: 0,
                        explanation: "çµ¶å¯¾é›¶åº¦ã¯-273.15â„ƒã§ã€ç†è«–ä¸Šã“ã‚Œä»¥ä¸‹ã®æ¸©åº¦ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚"
                    }
                ],
                history: [
                    {
                        question: "æ—¥æœ¬ã§æœ€åˆã®å¥³æ€§å¤©çš‡ã¯ï¼Ÿ",
                        choices: ["æ¨å¤å¤©çš‡", "æŒçµ±å¤©çš‡", "å…ƒæ˜å¤©çš‡", "å…ƒæ­£å¤©çš‡"],
                        correct: 0,
                        explanation: "æ¨å¤å¤©çš‡ï¼ˆ592-628å¹´åœ¨ä½ï¼‰ã¯æ—¥æœ¬å²ä¸Šåˆã®å¥³æ€§å¤©çš‡ã§ã™ã€‚"
                    }
                ],
                geography: [
                    {
                        question: "ä¸–ç•Œã§æœ€ã‚‚æ·±ã„æµ·æºã¯ï¼Ÿ",
                        choices: ["ãƒãƒªã‚¢ãƒŠæµ·æº", "æ—¥æœ¬æµ·æº", "ãƒ•ã‚£ãƒªãƒ”ãƒ³æµ·æº", "ãƒˆãƒ³ã‚¬æµ·æº"],
                        correct: 0,
                        explanation: "ãƒãƒªã‚¢ãƒŠæµ·æºã®æœ€æ·±éƒ¨ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼æµ·æ·µï¼‰ã¯ç´„11,000mã®æ·±ã•ãŒã‚ã‚Šã¾ã™ã€‚"
                    }
                ],
                sports: [
                    {
                        question: "ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ã®äº”è¼ªã®è‰²ã«å«ã¾ã‚Œãªã„ã®ã¯ï¼Ÿ",
                        choices: ["ç´«", "é’", "é»„", "ç·‘"],
                        correct: 0,
                        explanation: "ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ã®äº”è¼ªã®è‰²ã¯é’ãƒ»é»„ãƒ»é»’ãƒ»ç·‘ãƒ»èµ¤ã®5è‰²ã§ã™ã€‚"
                    }
                ],
                entertainment: [
                    {
                        question: "ã‚¢ã‚«ãƒ‡ãƒŸãƒ¼è³ã®æ­£å¼åç§°ã¯ï¼Ÿ",
                        choices: ["ã‚ªã‚¹ã‚«ãƒ¼", "Academy Awards", "Golden Awards", "Film Awards"],
                        correct: 1,
                        explanation: "æ­£å¼åç§°ã¯Academy Awardsã§ã€ã‚ªã‚¹ã‚«ãƒ¼ã¯æ„›ç§°ã§ã™ã€‚"
                    }
                ],
                technology: [
                    {
                        question: "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®å‰èº«ã¨ãªã£ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ï¼Ÿ",
                        choices: ["ARPANET", "ETHERNET", "INTRANET", "TELNET"],
                        correct: 0,
                        explanation: "ARPANETã¯1969å¹´ã«é–‹ç™ºã•ã‚ŒãŸã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®å‰èº«ã¨ãªã£ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚"
                    }
                ]
            };
            
            const genre = gameState.selectedGenre;
            const quizzes = demoQuizzes[genre] || demoQuizzes.science;
            
            // 5å•ã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™
            while (quizzes.length < gameConfig.totalQuestions) {
                quizzes.push(quizzes[0]);
            }
            
            return quizzes.slice(0, gameConfig.totalQuestions);
        }

        // å•é¡Œã‚’è¡¨ç¤º
        function displayQuestion() {
            const quiz = gameState.quizzes[gameState.currentQuestion];
            
            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
            document.getElementById('quizCounter').textContent = 
                `å•é¡Œ ${gameState.currentQuestion + 1} / ${gameConfig.totalQuestions}`;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
            const progress = ((gameState.currentQuestion + 1) / gameConfig.totalQuestions) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // å•é¡Œæ–‡è¡¨ç¤º
            document.getElementById('questionText').textContent = quiz.question;
            
            // é¸æŠè‚¢è¡¨ç¤º
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';
            
            quiz.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = choice;
                button.onclick = () => selectAnswer(index);
                answersContainer.appendChild(button);
            });
            
            // è§£èª¬ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆéè¡¨ç¤ºã«ã™ã‚‹ãŒã€ã‚¹ãƒšãƒ¼ã‚¹ã¯ç¢ºä¿ï¼‰
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.classList.remove('show');
            explanationDiv.innerHTML = '';
            
            document.getElementById('nextBtn').style.display = 'none';
            
            // ã‚¹ã‚³ã‚¢æ›´æ–°
            document.getElementById('currentScore').textContent = gameState.score;
            document.getElementById('totalQuestions').textContent = gameConfig.totalQuestions;
            
            gameState.isAnswered = false;
        }

        // å›ç­”ã‚’é¸æŠ
        function selectAnswer(index) {
            if (gameState.isAnswered) return;
            
            gameState.isAnswered = true;
            const quiz = gameState.quizzes[gameState.currentQuestion];
            const isCorrect = index === quiz.correct;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã‚’ä¿å­˜
            gameState.userAnswers.push(index);
            
            // æ­£èª¤åˆ¤å®š
            if (isCorrect) {
                gameState.score++;
            }
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, i) => {
                btn.classList.add('disabled');
                if (i === index) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
                if (i === quiz.correct) {
                    btn.classList.add('correct');
                }
            });
            
            // è§£èª¬ã‚’è¡¨ç¤ºï¼ˆãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <strong>${isCorrect ? 'âœ… æ­£è§£ï¼' : 'âŒ ä¸æ­£è§£'}</strong><br>
                ${quiz.explanation}
            `;
            explanationDiv.classList.add('show');
            
            // ã‚¹ã‚³ã‚¢æ›´æ–°
            document.getElementById('currentScore').textContent = gameState.score;
            
            // æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            if (gameState.currentQuestion < gameConfig.totalQuestions - 1) {
                document.getElementById('nextBtn').style.display = 'inline-block';
            } else {
                // æœ€å¾Œã®å•é¡Œã®å ´åˆã€å°‘ã—å¾…ã£ã¦ã‹ã‚‰çµæœè¡¨ç¤º
                setTimeout(showResult, 2000);
            }
        }

        // æ¬¡ã®å•é¡Œã¸
        function nextQuestion() {
            gameState.currentQuestion++;
            displayQuestion();
        }

        // çµæœã‚’è¡¨ç¤º
        function showResult() {
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            
            const percentage = (gameState.score / gameConfig.totalQuestions) * 100;
            document.getElementById('finalScore').textContent = 
                `${gameState.score} / ${gameConfig.totalQuestions}`;
            
            let message = '';
            if (percentage === 100) {
                message = 'ğŸ† ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ç´ æ™´ã‚‰ã—ã„æˆç¸¾ã§ã™ï¼';
            } else if (percentage >= 80) {
                message = 'ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼ã‚ˆãã§ãã¾ã—ãŸï¼';
            } else if (percentage >= 60) {
                message = 'ğŸ‘ è‰¯ã„æˆç¸¾ã§ã™ï¼';
            } else if (percentage >= 40) {
                message = 'ğŸ’ª ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
            } else {
                message = 'ğŸ“š å¾©ç¿’ã—ã¦ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼';
            }
            
            document.getElementById('resultMessage').textContent = message;
        }

        // ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState = {
                selectedGenre: null,
                currentQuestion: 0,
                score: 0,
                quizzes: [],
                userAnswers: [],
                isAnswered: false
            };
            
            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('genreSection').style.display = 'block';
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('startBtn').disabled = true;
            
            // è§£èª¬ã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.classList.remove('show');
            explanationDiv.innerHTML = '';
            
            // ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.genre-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('progressFill').style.width = '20%';
            
            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('totalQuestions').textContent = '5';
            
            // æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            document.getElementById('nextBtn').style.display = 'none';
        }

        // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
        async function checkServerHealth() {
            try {
                const headers = {
                    'Content-Type': 'application/json',
                };
                
                // APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è¿½åŠ 
                if (gameConfig.apiKey) {
                    headers['X-API-Key'] = gameConfig.apiKey;
                }
                
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã®fetch
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
                
                const response = await fetch(gameConfig.apiEndpoint, {
                    method: 'POST',
                    headers: headers,
                    signal: controller.signal,
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'user',
                                content: 'test'
                            }
                        ],
                        max_tokens: 1
                    })
                });
                
                clearTimeout(timeoutId);
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ200ç•ªå°ã¾ãŸã¯400ç•ªå°ï¼ˆAPIè‡ªä½“ã¯å‹•ã„ã¦ã„ã‚‹ï¼‰ãªã‚‰æˆåŠŸã¨ã¿ãªã™
                if (response.status >= 200 && response.status < 500) {
                    // ã‚µãƒ¼ãƒãƒ¼ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹
                    serverAvailable = true;
                    document.getElementById('errorMessage').classList.remove('show');
                    
                    // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                    document.querySelectorAll('.genre-card').forEach(card => {
                        card.style.opacity = '1';
                        card.style.cursor = 'pointer';
                    });
                    
                    return true;
                } else {
                    throw new Error('Server error');
                }
                
            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆï¼ˆæ¥ç¶šã‚¨ãƒ©ãƒ¼ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã©ï¼‰
                console.error('Server health check failed:', error);
                serverAvailable = false;
                document.getElementById('errorMessage').classList.add('show');
                
                // ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                document.getElementById('startBtn').disabled = true;
                
                // ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠã‚‚ç„¡åŠ¹åŒ–
                document.querySelectorAll('.genre-card').forEach(card => {
                    card.style.opacity = '0.5';
                    card.style.cursor = 'not-allowed';
                });
                
                return false;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            // åˆæœŸçŠ¶æ…‹ã§ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('startBtn').disabled = true;
            document.querySelectorAll('.genre-card').forEach(card => {
                card.style.opacity = '0.5';
                card.style.cursor = 'not-allowed';
            });
            
            // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
            checkServerHealth();
        });
    </script>
</body>
</html>